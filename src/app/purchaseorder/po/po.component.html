<div class="row">
  <div class="col-sm-6 col-lg-6">
    <h3>
      Purchase Orders
    </h3>
  </div>
  <div class="col-sm-6 col-lg-6">
    <div class="pull-right hidden-xs">
      <ol class="breadcrumb" id="dynamicbreadcrumb">
        <li>
          <i class="fa fa-shopping-cart"></i> <span> Procurements</span>
        </li>
        <li>
          <i class="fa fa-list-ul"></i> <span> Purchase Order</span>
        </li>
        <li class="active">
          <i class="fa fa-save"></i>
          Save
        </li>
      </ol>
    </div>
  </div>
</div>
<form autocomplete="off" (ngSubmit)="saveData()" [formGroup]="poForm">
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="row">
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
          <span class="spanheader">
            {{panelTitle}}
          </span>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 ">
          <div class="pull-right">
            <button class="btn btn-primary" routerLinkActive="active" routerLink="/Polist">Back</button>
          </div>
        </div>
      </div>
      <div class="clearfix"></div>
    </div>

    <div class="panel-body">
      <div class="row">
        <div class="col-md-3">
          <div class="form-group">
            <label class="control-label" for="poOrder.PONumber">PO Number<span class="mandantory"> *</span></label>
            <br />
            <!-- <input readonly type="text" name="poOrder.PONumber" [(ngModel)]="poOrder.PONumber" id="poOrder.PONumber"
              class="form-control"> -->
            {{poOrder.PONumber  }}
          </div>
        </div>
        <div class="col-md-3" [ngClass]="{'has-error': formErrors.PODate}">
          <div class="form-group">
            <label class="control-label" for="PODate">PO Date<span class="mandantory"> *</span></label>
            <div class="">
              <div class='input-group date'>

                <input type="text" ngxDaterangepickerMd [minDate]="poMinDate" [maxDate]="poMaxDate"
                  [singleDatePicker]="true" class="form-control" id="PODate" [locale]="{format: 'MM-DD-YYYY HH:mm'}"
                  [timePicker]="true" maxlength="16" [autoApply]="true" (blur)="logValidationErrors()"
                  formControlName="PODate" />

                <label class="fa fa-calendar"></label>
              </div>
              <div class="help-block-rk">
                <span class="help-block" *ngIf="formErrors.PODate">
                  {{formErrors.PODate}}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3" [ngClass]="{'has-error': formErrors.PODeliveryDate}">
          <div class="form-group">
            <label class="control-label" for="PODeliveryDate">PO DeliveryDate<span class="mandantory">
                *</span></label>
            <div class="">
              <div class='input-group date'>

                <input type="text" ngxDaterangepickerMd [minDate]="poDeliveryMinDate" [maxDate]="poDeliveryMaxDate"
                  [singleDatePicker]="true" class="form-control" id="PODeliveryDate" [locale]="{format: 'MM-DD-YYYY HH:mm'}"
                   [timePicker]="true" maxlength="16" [autoApply]="true"
                  (blur)="logValidationErrors()" formControlName="PODeliveryDate" />

                <label class="fa fa-calendar"></label>
              </div>
              <div class="help-block-rk">
                <span class="help-block" *ngIf="formErrors.PODeliveryDate">
                  {{formErrors.PODeliveryDate}}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3" *ngIf="poOrder.POID == 0">
          <div class="form-group">
            <label class="control-label" for="Location">Location<span class="mandantory"> *</span></label>
            <select class="form-control" name="poOrder.LocationID" id="Location" [disabled]="poOrder.POID > 0"
              (change)="onLocationChange($event.target.value)" (blur)="logValidationErrors()"
              formControlName="LocationID">
              <option value="0" selected="selected">Select</option>
              <option *ngFor="let location of locationList" value={{location.LocationID}}>
                {{location.LocationName}}
              </option>
            </select>
            <div class="help-block-rk">
              <span class="help-block" *ngIf="formErrors.LocationID">
                {{formErrors.LocationID}}
              </span>
            </div>
          </div>
        </div>

        <div class="col-md-3" *ngIf="poOrder.POID > 0">
          <div class="form-group">
            <label class="control-label" for="Location">Location<span class="mandantory"> *</span></label>
            <div>
              {{poOrder.LocationName}}
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-3" *ngIf="poOrder.POID == 0">
          <div class="form-group">
            <label class="control-label" for="Vendor">Vendor<span class="mandantory"> *</span></label>
            <select class="form-control" name="poOrder.VendorID" id="Vendor"
              [disabled]="poOrder.POID > 0 || gridData.length> 0" (change)="onVendorChanged($event.target.value)"
              (blur)="logValidationErrors()" formControlName="VendorID">
              <option value="0" selected="selected">Select</option>
              <option *ngFor="let vendor of vendorList" value={{vendor.VendorID}}>
                {{vendor.VendorName}}
              </option>
            </select>
            <div class="help-block-rk">
              <span class="help-block" *ngIf="formErrors.VendorID">
                {{formErrors.VendorID}}
              </span>
            </div>
          </div>
        </div>

        <div class="col-md-3" *ngIf="poOrder.POID > 0">
          <div class="form-group">
            <label class="control-label" for="Vendor">Vendor<span class="mandantory"> *</span></label>
            <div>
              {{poOrder.VendorName}}
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label class="control-label" for="eventpurchase"> Event Purchase</label>
            <br />
            <input type="checkbox" name="poOrder.IsEventPurchase" id="eventpurchase" formControlName="IsEventPurchase">
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label class="control-label" for="isshipmentrequired">Is Shipment Required</label>
            <br />
            <input type="checkbox" id="isshipmentrequired" name="poOrder.IsShipmentRequired"
              [disabled]="poOrder.POID > 0" formControlName="IsShipmentRequired">

          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label class="control-label" for="otherreference">Other Reference<span class="mandantory">
                *</span></label>
            <input type="text" name="poOrder.OtherReference" id="otherreference" class="form-control"
              (blur)="logValidationErrors()" formControlName="OtherReference" maxlength="50">

            <div class="help-block-rk">
              <span class="help-block" *ngIf="formErrors.OtherReference">
                {{formErrors.OtherReference}}
              </span>
            </div>
          </div>
        </div>

      </div>
      <div class="row">
        <div class="col-md-3">
          <div class="form-group">
            <label class="control-label" for="againstreference">Against Reference</label>
            <input type="text" name="poOrder.AgainstReference" id="againstreference" class="form-control"
              (blur)="logValidationErrors()" formControlName="AgainstReference" maxlength="50">
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label class="control-label" for="paymentreference">Payment Reference</label>
            <input type="text" name="poOrder.PaymentReference" id="paymentreference" class="form-control"
              (blur)="logValidationErrors()" formControlName="PaymentReference" maxlength="50">
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label class="control-label" for="remarks">Remarks</label>
            <input type="textarea" name="poOrder.Remarks" id="remarks" class="form-control"
              (blur)="logValidationErrors()" formControlName="Remarks" maxlength="250">
          </div>
        </div>
      </div>
    </div>
    <div>
      <span class="spanheader">Order Items</span>
    </div>
    <kendo-grid [data]="gridData" (edit)="editHandler($event)" (cancel)="cancelHandler($event)"
      (save)="saveHandler($event)" (remove)="removeHandler($event)" (add)="addHandler($event)" [height]="410">
      <ng-template kendoGridToolbarTemplate>
        <button kendoGridAddCommand>Add Item</button>
      </ng-template>

      <kendo-grid-column field="ItemCode" title="ItemCode" width="150">
        <ng-template kendoGridCellTemplate let-dataItem>
          {{item(dataItem.ItemID)?.ItemCode}}
        </ng-template>
        <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-column="column" let-formGroup="itemFormGroup">
          <kendo-dropdownlist #ddl="popupAnchor" popupAnchor [data]="itemList" textField="ItemCode" valueField="ItemID"
            [valuePrimitive]="true" [formControl]="itemFormGroup.get(column.field)"
            (valueChange)="getItemDescription($event)">
          </kendo-dropdownlist>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column field="ItemName" title="ItemDescription" width="200">
        <ng-template kendoGridEditTemplate let-column="column" let-formGroup="itemFormGroup" let-isNew="isNew">
          <input #input [readonly]="true" class="k-textbox" [formControl]="itemFormGroup.get(column.field)">
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column field="VendorItemCode" title="VendorItemCode" width="200">
        <ng-template kendoGridEditTemplate let-column="column" let-formGroup="itemFormGroup" let-isNew="isNew">
          <input #input [readonly]="true" class="k-textbox" [formControl]="itemFormGroup.get(column.field)">
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column field="CaseSize" title="Units" width="100">
        <ng-template kendoGridEditTemplate let-column="column" let-formGroup="itemFormGroup" let-isNew="isNew">
          <kendo-numerictextbox #ntb="popupAnchor" popupAnchor (valueChange)="onCaseSizeChanged($event)"
            [formControl]="itemFormGroup.get(column.field)" format="##"></kendo-numerictextbox>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column field="UOM" title="UOM" width="150">
        <ng-template kendoGridCellTemplate let-dataItem>
          {{uomDetail(dataItem.UOMID)?.UOM}}
        </ng-template>
        <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-column="column" let-formGroup="itemFormGroup">
          <kendo-dropdownlist #ddl="popupAnchor" popupAnchor [data]="uomList" textField="UOM" valueField="UOMID"
            [valuePrimitive]="true" (valueChange)="onUOMChanged($event)" [formControl]="itemFormGroup.get('UOM')">
          </kendo-dropdownlist>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column field="Rate" title="Rate" width="120">
        <ng-template kendoGridEditTemplate let-column="column" let-formGroup="itemFormGroup" let-isNew="isNew">
          <kendo-numerictextbox #ntb="popupAnchor" popupAnchor (valueChange)="onRateChanged($event)"
            [formControl]="itemFormGroup.get(column.field)" format="0.##" maxlength="15"></kendo-numerictextbox>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column field="TaxRate" title="TaxRate" width="100">
        <ng-template kendoGridEditTemplate let-column="column" let-formGroup="itemFormGroup" let-isNew="isNew">
          <kendo-numerictextbox #ntb="popupAnchor" popupAnchor [readonly]="true"
            [formControl]="itemFormGroup.get(column.field)" format="0.##"></kendo-numerictextbox>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column field="DirectCost" title="DirectCost" width="150">
        <ng-template kendoGridEditTemplate let-column="column" let-formGroup="itemFormGroup" let-isNew="isNew">
          <kendo-numerictextbox #ntb="popupAnchor" popupAnchor [readonly]="true"
            [formControl]="itemFormGroup.get(column.field)" format="0.##"></kendo-numerictextbox>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column field="TaxAmount" title="TaxAmount" width="150">
        <ng-template kendoGridEditTemplate let-column="column" let-formGroup="itemFormGroup" let-isNew="isNew">
          <kendo-numerictextbox #ntb="popupAnchor" popupAnchor [readonly]="true"
            [formControl]="itemFormGroup.get(column.field)" format="0.##"></kendo-numerictextbox>
        </ng-template>
      </kendo-grid-column>
      <!-- [readonly]="totalAmountFieldDisabled" -->
      <kendo-grid-column field="TotalAmount" title="TotalAmount" width="150">
        <ng-template kendoGridEditTemplate let-column="column" let-formGroup="itemFormGroup" let-isNew="isNew">
          <kendo-numerictextbox #ntb="popupAnchor" popupAnchor (valueChange)="onTotalAmountChanged($event)"
            [formControl]="itemFormGroup.get(column.field)" format="0.##" [readonly]="true">
          </kendo-numerictextbox>
        </ng-template>
      </kendo-grid-column>


      <!-- <kendo-grid-column field="UnitPrice" title="Price" format="{0:c}" width="80" editor="numeric">
      </kendo-grid-column> -->


      <kendo-grid-command-column title="Action" width="220">
        <ng-template kendoGridCellTemplate let-isNew="isNew">
          <button kendoGridEditCommand [primary]="true">Edit</button>
          <button kendoGridRemoveCommand>Remove</button>
          <button kendoGridSaveCommand [disabled]="itemFormGroup?.invalid">{{ isNew ? 'Add' : 'Update' }}</button>
          <button kendoGridCancelCommand>{{ isNew ? 'Discard' : 'Cancel' }}</button>
        </ng-template>
      </kendo-grid-command-column>
    </kendo-grid>

    <div class="panel-footer " *ngIf="(poOrder.ApprovalStatus!='Approved')">
      <div class="btn-toolbar pull-right">

        <button type="button" id="cancel" class="btn btn-default" routerLink="/Polist">Cancel</button>
        <button prevent-double-submit type="submit" id="save" class="btn btn-success"
          [disabled]="!poForm.valid">Save</button>

      </div>
      <div class="clearfix"></div>
    </div>
  </div>
</form>